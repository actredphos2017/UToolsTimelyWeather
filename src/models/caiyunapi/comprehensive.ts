import {RealtimeData} from "./realtime.ts";
import {MinutelyData} from "./minutely.ts";
import {HourlyData} from "./hourly.ts";
import {DailyData} from "./daily.ts";
import {AlertResult} from "./alert.ts";
import {defaultLongLatitude, LongLatitude, parseCaiyunLLFormat} from "../models.ts";
import axios from "axios"

const testJson = `
{"status":"ok","api_version":"v2.6","api_status":"alpha","lang":"zh_CN","unit":"metric","tzshift":28800,"timezone":"Asia/Shanghai","server_time":1711291280,"location":[34.44,116.37],"result":{"alert":{"status":"ok","content":[],"adcodes":[{"adcode":340000,"name":"安徽省"},{"adcode":341300,"name":"宿州市"},{"adcode":341321,"name":"砀山县"}]},"realtime":{"status":"ok","temperature":10.19,"humidity":0.82,"cloudrate":1,"skycon":"LIGHT_RAIN","visibility":2.2,"dswrf":0,"wind":{"speed":16.21,"direction":35.02},"pressure":101158.19,"apparent_temperature":7,"precipitation":{"local":{"status":"ok","datasource":"radar","intensity":0.0795},"nearest":{"status":"ok","distance":0.6,"intensity":0.3125}},"air_quality":{"pm25":30,"pm10":0,"o3":0,"so2":0,"no2":0,"co":0,"aqi":{"chn":55,"usa":0},"description":{"usa":"","chn":"良"}},"life_index":{"ultraviolet":{"index":0,"desc":"无"},"comfort":{"index":9,"desc":"寒冷"}}},"minutely":{"status":"ok","datasource":"radar","precipitation_2h":[0.0795,0.0742,0.0941,0.1337,0.1875,0.25,0.3156,0.3789,0.4344,0.4766,0.5,0.5008,0.4822,0.4492,0.4066,0.3594,0.3125,0.2699,0.2323,0.1992,0.1706,0.1459,0.125,0.1076,0.0933,0.0819,0.0732,0.0668,0.0625,0.06,0.0589,0.059,0.0598,0.0611,0.0625,0.0637,0.0645,0.0649,0.0648,0.064,0.0625,0.0603,0.058,0.0563,0.056,0.0578,0.0625,0.0705,0.0809,0.0927,0.1047,0.1159,0.125,0.1312,0.1346,0.1354,0.1339,0.1303,0.125,0.1185,0.1122,0.1079,0.1075,0.1126,0.125,0.1455,0.1713,0.1985,0.2232,0.2416,0.25,0.2456,0.2304,0.2076,0.1803,0.1517,0.125,0.1027,0.0854,0.0728,0.0649,0.0615,0.0625,0.0674,0.0739,0.0793,0.081,0.0763,0.0625,0.038,0.0057,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"precipitation":[0.0795,0.0742,0.0941,0.1337,0.1875,0.25,0.3156,0.3789,0.4344,0.4766,0.5,0.5008,0.4822,0.4492,0.4066,0.3594,0.3125,0.2699,0.2323,0.1992,0.1706,0.1459,0.125,0.1076,0.0933,0.0819,0.0732,0.0668,0.0625,0.06,0.0589,0.059,0.0598,0.0611,0.0625,0.0637,0.0645,0.0649,0.0648,0.064,0.0625,0.0603,0.058,0.0563,0.056,0.0578,0.0625,0.0705,0.0809,0.0927,0.1047,0.1159,0.125,0.1312,0.1346,0.1354,0.1339,0.1303,0.125,0.1185],"probability":[0.9536089652996245,0.9558061085490721,0.9810741556583842,0],"description":"19分钟后雨渐小，转为小雨，直到一小时后雨停"},"hourly":{"status":"ok","description":"小雨，明天早晨7点钟后雨停，转阴","precipitation":[{"datetime":"2024-03-24T22:00+08:00","value":5.0025,"probability":95},{"datetime":"2024-03-24T23:00+08:00","value":0.2286,"probability":49},{"datetime":"2024-03-25T00:00+08:00","value":0.0958,"probability":60},{"datetime":"2024-03-25T01:00+08:00","value":2.6382,"probability":70},{"datetime":"2024-03-25T02:00+08:00","value":0.2841,"probability":60},{"datetime":"2024-03-25T03:00+08:00","value":1.8469,"probability":70},{"datetime":"2024-03-25T04:00+08:00","value":1.2106,"probability":70},{"datetime":"2024-03-25T05:00+08:00","value":1.8889,"probability":70},{"datetime":"2024-03-25T06:00+08:00","value":0.5504,"probability":60},{"datetime":"2024-03-25T07:00+08:00","value":0.0489,"probability":0},{"datetime":"2024-03-25T08:00+08:00","value":0,"probability":0},{"datetime":"2024-03-25T09:00+08:00","value":0,"probability":0},{"datetime":"2024-03-25T10:00+08:00","value":0,"probability":0},{"datetime":"2024-03-25T11:00+08:00","value":0,"probability":0},{"datetime":"2024-03-25T12:00+08:00","value":0,"probability":0},{"datetime":"2024-03-25T13:00+08:00","value":0,"probability":0},{"datetime":"2024-03-25T14:00+08:00","value":0,"probability":0},{"datetime":"2024-03-25T15:00+08:00","value":0,"probability":0},{"datetime":"2024-03-25T16:00+08:00","value":0,"probability":0},{"datetime":"2024-03-25T17:00+08:00","value":0,"probability":0},{"datetime":"2024-03-25T18:00+08:00","value":0,"probability":0},{"datetime":"2024-03-25T19:00+08:00","value":0,"probability":0},{"datetime":"2024-03-25T20:00+08:00","value":0,"probability":0},{"datetime":"2024-03-25T21:00+08:00","value":0,"probability":0}],"temperature":[{"datetime":"2024-03-24T22:00+08:00","value":10.19},{"datetime":"2024-03-24T23:00+08:00","value":9.43},{"datetime":"2024-03-25T00:00+08:00","value":9.4},{"datetime":"2024-03-25T01:00+08:00","value":9.37},{"datetime":"2024-03-25T02:00+08:00","value":9.35},{"datetime":"2024-03-25T03:00+08:00","value":8.82},{"datetime":"2024-03-25T04:00+08:00","value":8.29},{"datetime":"2024-03-25T05:00+08:00","value":7.67},{"datetime":"2024-03-25T06:00+08:00","value":7.71},{"datetime":"2024-03-25T07:00+08:00","value":7.75},{"datetime":"2024-03-25T08:00+08:00","value":7.78},{"datetime":"2024-03-25T09:00+08:00","value":8.26},{"datetime":"2024-03-25T10:00+08:00","value":8.72},{"datetime":"2024-03-25T11:00+08:00","value":9.19},{"datetime":"2024-03-25T12:00+08:00","value":9.73},{"datetime":"2024-03-25T13:00+08:00","value":10.26},{"datetime":"2024-03-25T14:00+08:00","value":10.78},{"datetime":"2024-03-25T15:00+08:00","value":10.68},{"datetime":"2024-03-25T16:00+08:00","value":10.59},{"datetime":"2024-03-25T17:00+08:00","value":10.5},{"datetime":"2024-03-25T18:00+08:00","value":10.14},{"datetime":"2024-03-25T19:00+08:00","value":9.78},{"datetime":"2024-03-25T20:00+08:00","value":9.44},{"datetime":"2024-03-25T21:00+08:00","value":8.3}],"apparent_temperature":[{"datetime":"2024-03-24T22:00+08:00","value":7},{"datetime":"2024-03-24T23:00+08:00","value":6.6},{"datetime":"2024-03-25T00:00+08:00","value":6.1},{"datetime":"2024-03-25T01:00+08:00","value":5.5},{"datetime":"2024-03-25T02:00+08:00","value":5.5},{"datetime":"2024-03-25T03:00+08:00","value":4.6},{"datetime":"2024-03-25T04:00+08:00","value":3.5},{"datetime":"2024-03-25T05:00+08:00","value":3.2},{"datetime":"2024-03-25T06:00+08:00","value":3.9},{"datetime":"2024-03-25T07:00+08:00","value":4.2},{"datetime":"2024-03-25T08:00+08:00","value":3.7},{"datetime":"2024-03-25T09:00+08:00","value":4.5},{"datetime":"2024-03-25T10:00+08:00","value":4.8},{"datetime":"2024-03-25T11:00+08:00","value":5.4},{"datetime":"2024-03-25T12:00+08:00","value":6.1},{"datetime":"2024-03-25T13:00+08:00","value":6.5},{"datetime":"2024-03-25T14:00+08:00","value":6.9},{"datetime":"2024-03-25T15:00+08:00","value":6.9},{"datetime":"2024-03-25T16:00+08:00","value":7.1},{"datetime":"2024-03-25T17:00+08:00","value":7.6},{"datetime":"2024-03-25T18:00+08:00","value":7.5},{"datetime":"2024-03-25T19:00+08:00","value":7.6},{"datetime":"2024-03-25T20:00+08:00","value":7.3},{"datetime":"2024-03-25T21:00+08:00","value":6.3}],"wind":[{"datetime":"2024-03-24T22:00+08:00","speed":16.21,"direction":35.02},{"datetime":"2024-03-24T23:00+08:00","speed":12.77,"direction":11.17},{"datetime":"2024-03-25T00:00+08:00","speed":15.45,"direction":9.39},{"datetime":"2024-03-25T01:00+08:00","speed":18.53,"direction":4.09},{"datetime":"2024-03-25T02:00+08:00","speed":18.65,"direction":1},{"datetime":"2024-03-25T03:00+08:00","speed":20.51,"direction":358.16},{"datetime":"2024-03-25T04:00+08:00","speed":23.82,"direction":4.93},{"datetime":"2024-03-25T05:00+08:00","speed":21.59,"direction":10.92},{"datetime":"2024-03-25T06:00+08:00","speed":18.59,"direction":4.82},{"datetime":"2024-03-25T07:00+08:00","speed":17.18,"direction":1.79},{"datetime":"2024-03-25T08:00+08:00","speed":19.77,"direction":0.2},{"datetime":"2024-03-25T09:00+08:00","speed":18.09,"direction":352.74},{"datetime":"2024-03-25T10:00+08:00","speed":19.47,"direction":350.41},{"datetime":"2024-03-25T11:00+08:00","speed":19.11,"direction":1.65},{"datetime":"2024-03-25T12:00+08:00","speed":17.95,"direction":3.54},{"datetime":"2024-03-25T13:00+08:00","speed":18.82,"direction":0.78},{"datetime":"2024-03-25T14:00+08:00","speed":19.94,"direction":351.2},{"datetime":"2024-03-25T15:00+08:00","speed":19.48,"direction":347.75},{"datetime":"2024-03-25T16:00+08:00","speed":18.53,"direction":345.44},{"datetime":"2024-03-25T17:00+08:00","speed":14.92,"direction":353.29},{"datetime":"2024-03-25T18:00+08:00","speed":13.58,"direction":348.61},{"datetime":"2024-03-25T19:00+08:00","speed":11.05,"direction":345.86},{"datetime":"2024-03-25T20:00+08:00","speed":10.15,"direction":346.7},{"datetime":"2024-03-25T21:00+08:00","speed":8.67,"direction":318.26}],"humidity":[{"datetime":"2024-03-24T22:00+08:00","value":0.82},{"datetime":"2024-03-24T23:00+08:00","value":0.77},{"datetime":"2024-03-25T00:00+08:00","value":0.79},{"datetime":"2024-03-25T01:00+08:00","value":0.78},{"datetime":"2024-03-25T02:00+08:00","value":0.79},{"datetime":"2024-03-25T03:00+08:00","value":0.81},{"datetime":"2024-03-25T04:00+08:00","value":0.86},{"datetime":"2024-03-25T05:00+08:00","value":0.89},{"datetime":"2024-03-25T06:00+08:00","value":0.91},{"datetime":"2024-03-25T07:00+08:00","value":0.91},{"datetime":"2024-03-25T08:00+08:00","value":0.9},{"datetime":"2024-03-25T09:00+08:00","value":0.87},{"datetime":"2024-03-25T10:00+08:00","value":0.86},{"datetime":"2024-03-25T11:00+08:00","value":0.85},{"datetime":"2024-03-25T12:00+08:00","value":0.79},{"datetime":"2024-03-25T13:00+08:00","value":0.79},{"datetime":"2024-03-25T14:00+08:00","value":0.77},{"datetime":"2024-03-25T15:00+08:00","value":0.79},{"datetime":"2024-03-25T16:00+08:00","value":0.82},{"datetime":"2024-03-25T17:00+08:00","value":0.83},{"datetime":"2024-03-25T18:00+08:00","value":0.84},{"datetime":"2024-03-25T19:00+08:00","value":0.86},{"datetime":"2024-03-25T20:00+08:00","value":0.87},{"datetime":"2024-03-25T21:00+08:00","value":0.87}],"cloudrate":[{"datetime":"2024-03-24T22:00+08:00","value":1},{"datetime":"2024-03-24T23:00+08:00","value":1},{"datetime":"2024-03-25T00:00+08:00","value":1},{"datetime":"2024-03-25T01:00+08:00","value":1},{"datetime":"2024-03-25T02:00+08:00","value":1},{"datetime":"2024-03-25T03:00+08:00","value":1},{"datetime":"2024-03-25T04:00+08:00","value":1},{"datetime":"2024-03-25T05:00+08:00","value":1},{"datetime":"2024-03-25T06:00+08:00","value":1},{"datetime":"2024-03-25T07:00+08:00","value":1},{"datetime":"2024-03-25T08:00+08:00","value":1},{"datetime":"2024-03-25T09:00+08:00","value":1},{"datetime":"2024-03-25T10:00+08:00","value":1},{"datetime":"2024-03-25T11:00+08:00","value":1},{"datetime":"2024-03-25T12:00+08:00","value":1},{"datetime":"2024-03-25T13:00+08:00","value":1},{"datetime":"2024-03-25T14:00+08:00","value":1},{"datetime":"2024-03-25T15:00+08:00","value":1},{"datetime":"2024-03-25T16:00+08:00","value":1},{"datetime":"2024-03-25T17:00+08:00","value":1},{"datetime":"2024-03-25T18:00+08:00","value":1},{"datetime":"2024-03-25T19:00+08:00","value":1},{"datetime":"2024-03-25T20:00+08:00","value":1},{"datetime":"2024-03-25T21:00+08:00","value":0.69}],"skycon":[{"datetime":"2024-03-24T22:00+08:00","value":"HEAVY_RAIN"},{"datetime":"2024-03-24T23:00+08:00","value":"LIGHT_RAIN"},{"datetime":"2024-03-25T00:00+08:00","value":"LIGHT_RAIN"},{"datetime":"2024-03-25T01:00+08:00","value":"MODERATE_RAIN"},{"datetime":"2024-03-25T02:00+08:00","value":"LIGHT_RAIN"},{"datetime":"2024-03-25T03:00+08:00","value":"MODERATE_RAIN"},{"datetime":"2024-03-25T04:00+08:00","value":"MODERATE_RAIN"},{"datetime":"2024-03-25T05:00+08:00","value":"MODERATE_RAIN"},{"datetime":"2024-03-25T06:00+08:00","value":"LIGHT_RAIN"},{"datetime":"2024-03-25T07:00+08:00","value":"CLOUDY"},{"datetime":"2024-03-25T08:00+08:00","value":"CLOUDY"},{"datetime":"2024-03-25T09:00+08:00","value":"CLOUDY"},{"datetime":"2024-03-25T10:00+08:00","value":"CLOUDY"},{"datetime":"2024-03-25T11:00+08:00","value":"CLOUDY"},{"datetime":"2024-03-25T12:00+08:00","value":"CLOUDY"},{"datetime":"2024-03-25T13:00+08:00","value":"CLOUDY"},{"datetime":"2024-03-25T14:00+08:00","value":"CLOUDY"},{"datetime":"2024-03-25T15:00+08:00","value":"CLOUDY"},{"datetime":"2024-03-25T16:00+08:00","value":"CLOUDY"},{"datetime":"2024-03-25T17:00+08:00","value":"CLOUDY"},{"datetime":"2024-03-25T18:00+08:00","value":"CLOUDY"},{"datetime":"2024-03-25T19:00+08:00","value":"CLOUDY"},{"datetime":"2024-03-25T20:00+08:00","value":"FOG"},{"datetime":"2024-03-25T21:00+08:00","value":"PARTLY_CLOUDY_NIGHT"}],"pressure":[{"datetime":"2024-03-24T22:00+08:00","value":101158.19},{"datetime":"2024-03-24T23:00+08:00","value":101270.625},{"datetime":"2024-03-25T00:00+08:00","value":101241.303},{"datetime":"2024-03-25T01:00+08:00","value":101221.876},{"datetime":"2024-03-25T02:00+08:00","value":101196.721},{"datetime":"2024-03-25T03:00+08:00","value":101180.671},{"datetime":"2024-03-25T04:00+08:00","value":101200.469},{"datetime":"2024-03-25T05:00+08:00","value":101253.072},{"datetime":"2024-03-25T06:00+08:00","value":101340.753},{"datetime":"2024-03-25T07:00+08:00","value":101393.105},{"datetime":"2024-03-25T08:00+08:00","value":101433.609},{"datetime":"2024-03-25T09:00+08:00","value":101559.179},{"datetime":"2024-03-25T10:00+08:00","value":101580.577},{"datetime":"2024-03-25T11:00+08:00","value":101521.606},{"datetime":"2024-03-25T12:00+08:00","value":101558.741},{"datetime":"2024-03-25T13:00+08:00","value":101525.356},{"datetime":"2024-03-25T14:00+08:00","value":101524.162},{"datetime":"2024-03-25T15:00+08:00","value":101493.63},{"datetime":"2024-03-25T16:00+08:00","value":101501.582},{"datetime":"2024-03-25T17:00+08:00","value":101511.621},{"datetime":"2024-03-25T18:00+08:00","value":101585.036},{"datetime":"2024-03-25T19:00+08:00","value":101632.585},{"datetime":"2024-03-25T20:00+08:00","value":101682.786},{"datetime":"2024-03-25T21:00+08:00","value":101795.824}],"visibility":[{"datetime":"2024-03-24T22:00+08:00","value":2.2},{"datetime":"2024-03-24T23:00+08:00","value":1.38},{"datetime":"2024-03-25T00:00+08:00","value":1.22},{"datetime":"2024-03-25T01:00+08:00","value":1.26},{"datetime":"2024-03-25T02:00+08:00","value":1.21},{"datetime":"2024-03-25T03:00+08:00","value":1.09},{"datetime":"2024-03-25T04:00+08:00","value":0.9},{"datetime":"2024-03-25T05:00+08:00","value":0.79},{"datetime":"2024-03-25T06:00+08:00","value":0.74},{"datetime":"2024-03-25T07:00+08:00","value":0.75},{"datetime":"2024-03-25T08:00+08:00","value":0.78},{"datetime":"2024-03-25T09:00+08:00","value":0.85},{"datetime":"2024-03-25T10:00+08:00","value":0.89},{"datetime":"2024-03-25T11:00+08:00","value":0.94},{"datetime":"2024-03-25T12:00+08:00","value":1.24},{"datetime":"2024-03-25T13:00+08:00","value":1.2},{"datetime":"2024-03-25T14:00+08:00","value":1.37},{"datetime":"2024-03-25T15:00+08:00","value":1.22},{"datetime":"2024-03-25T16:00+08:00","value":1.05},{"datetime":"2024-03-25T17:00+08:00","value":1.02},{"datetime":"2024-03-25T18:00+08:00","value":0.97},{"datetime":"2024-03-25T19:00+08:00","value":0.89},{"datetime":"2024-03-25T20:00+08:00","value":0.86},{"datetime":"2024-03-25T21:00+08:00","value":0.85}],"dswrf":[{"datetime":"2024-03-24T22:00+08:00","value":0},{"datetime":"2024-03-24T23:00+08:00","value":0},{"datetime":"2024-03-25T00:00+08:00","value":0},{"datetime":"2024-03-25T01:00+08:00","value":0},{"datetime":"2024-03-25T02:00+08:00","value":0},{"datetime":"2024-03-25T03:00+08:00","value":0},{"datetime":"2024-03-25T04:00+08:00","value":0},{"datetime":"2024-03-25T05:00+08:00","value":0},{"datetime":"2024-03-25T06:00+08:00","value":0},{"datetime":"2024-03-25T07:00+08:00","value":0},{"datetime":"2024-03-25T08:00+08:00","value":41.75},{"datetime":"2024-03-25T09:00+08:00","value":45.201},{"datetime":"2024-03-25T10:00+08:00","value":54.096},{"datetime":"2024-03-25T11:00+08:00","value":118.64},{"datetime":"2024-03-25T12:00+08:00","value":125.657},{"datetime":"2024-03-25T13:00+08:00","value":150.783},{"datetime":"2024-03-25T14:00+08:00","value":137.842},{"datetime":"2024-03-25T15:00+08:00","value":119.426},{"datetime":"2024-03-25T16:00+08:00","value":104.027},{"datetime":"2024-03-25T17:00+08:00","value":91.966},{"datetime":"2024-03-25T18:00+08:00","value":74.173},{"datetime":"2024-03-25T19:00+08:00","value":61.858},{"datetime":"2024-03-25T20:00+08:00","value":0},{"datetime":"2024-03-25T21:00+08:00","value":0}],"air_quality":{"aqi":[{"datetime":"2024-03-24T22:00+08:00","value":{"chn":55,"usa":88}},{"datetime":"2024-03-24T23:00+08:00","value":{"chn":40,"usa":84}},{"datetime":"2024-03-25T00:00+08:00","value":{"chn":40,"usa":84}},{"datetime":"2024-03-25T01:00+08:00","value":{"chn":40,"usa":84}},{"datetime":"2024-03-25T02:00+08:00","value":{"chn":40,"usa":84}},{"datetime":"2024-03-25T03:00+08:00","value":{"chn":40,"usa":84}},{"datetime":"2024-03-25T04:00+08:00","value":{"chn":41,"usa":86}},{"datetime":"2024-03-25T05:00+08:00","value":{"chn":42,"usa":88}},{"datetime":"2024-03-25T06:00+08:00","value":{"chn":42,"usa":88}},{"datetime":"2024-03-25T07:00+08:00","value":{"chn":44,"usa":90}},{"datetime":"2024-03-25T08:00+08:00","value":{"chn":45,"usa":92}},{"datetime":"2024-03-25T09:00+08:00","value":{"chn":45,"usa":92}},{"datetime":"2024-03-25T10:00+08:00","value":{"chn":47,"usa":94}},{"datetime":"2024-03-25T11:00+08:00","value":{"chn":48,"usa":97}},{"datetime":"2024-03-25T12:00+08:00","value":{"chn":47,"usa":94}},{"datetime":"2024-03-25T13:00+08:00","value":{"chn":47,"usa":94}},{"datetime":"2024-03-25T14:00+08:00","value":{"chn":47,"usa":94}},{"datetime":"2024-03-25T15:00+08:00","value":{"chn":45,"usa":92}},{"datetime":"2024-03-25T16:00+08:00","value":{"chn":45,"usa":92}},{"datetime":"2024-03-25T17:00+08:00","value":{"chn":45,"usa":92}},{"datetime":"2024-03-25T18:00+08:00","value":{"chn":47,"usa":94}},{"datetime":"2024-03-25T19:00+08:00","value":{"chn":48,"usa":97}},{"datetime":"2024-03-25T20:00+08:00","value":{"chn":51,"usa":102}},{"datetime":"2024-03-25T21:00+08:00","value":{"chn":52,"usa":104}}],"pm25":[{"datetime":"2024-03-24T22:00+08:00","value":30},{"datetime":"2024-03-24T23:00+08:00","value":28},{"datetime":"2024-03-25T00:00+08:00","value":28},{"datetime":"2024-03-25T01:00+08:00","value":28},{"datetime":"2024-03-25T02:00+08:00","value":28},{"datetime":"2024-03-25T03:00+08:00","value":28},{"datetime":"2024-03-25T04:00+08:00","value":29},{"datetime":"2024-03-25T05:00+08:00","value":30},{"datetime":"2024-03-25T06:00+08:00","value":30},{"datetime":"2024-03-25T07:00+08:00","value":31},{"datetime":"2024-03-25T08:00+08:00","value":32},{"datetime":"2024-03-25T09:00+08:00","value":32},{"datetime":"2024-03-25T10:00+08:00","value":33},{"datetime":"2024-03-25T11:00+08:00","value":34},{"datetime":"2024-03-25T12:00+08:00","value":33},{"datetime":"2024-03-25T13:00+08:00","value":33},{"datetime":"2024-03-25T14:00+08:00","value":33},{"datetime":"2024-03-25T15:00+08:00","value":32},{"datetime":"2024-03-25T16:00+08:00","value":32},{"datetime":"2024-03-25T17:00+08:00","value":32},{"datetime":"2024-03-25T18:00+08:00","value":33},{"datetime":"2024-03-25T19:00+08:00","value":34},{"datetime":"2024-03-25T20:00+08:00","value":36},{"datetime":"2024-03-25T21:00+08:00","value":37}]}},"daily":{"status":"ok","astro":[{"date":"2024-03-24T00:00+08:00","sunrise":{"time":"06:12"},"sunset":{"time":"18:29"}}],"precipitation_08h_20h":[{"date":"2024-03-24T00:00+08:00","max":0,"min":0,"avg":0,"probability":0}],"precipitation_20h_32h":[{"date":"2024-03-24T00:00+08:00","max":5.0025,"min":0.0958,"avg":1.209,"probability":70}],"precipitation":[{"date":"2024-03-24T00:00+08:00","max":5.0025,"min":0,"avg":2.6156,"probability":80}],"temperature":[{"date":"2024-03-24T00:00+08:00","max":12.13,"min":9.26,"avg":9.81}],"temperature_08h_20h":[{"date":"2024-03-24T00:00+08:00","max":12.13,"min":9.26,"avg":10.61}],"temperature_20h_32h":[{"date":"2024-03-24T00:00+08:00","max":10.19,"min":7.67,"avg":9.15}],"wind":[{"date":"2024-03-24T00:00+08:00","max":{"speed":23.45,"direction":66.9},"min":{"speed":12.32,"direction":28.1},"avg":{"speed":16.97,"direction":63.12}}],"wind_08h_20h":[{"date":"2024-03-24T00:00+08:00","max":{"speed":19.51,"direction":78.11},"min":{"speed":13.42,"direction":55.93},"avg":{"speed":16.51,"direction":73.7}}],"wind_20h_32h":[{"date":"2024-03-24T00:00+08:00","max":{"speed":23.82,"direction":4.93},"min":{"speed":12.32,"direction":28.1},"avg":{"speed":17.18,"direction":11.22}}],"humidity":[{"date":"2024-03-24T00:00+08:00","max":0.96,"min":0.68,"avg":0.8}],"cloudrate":[{"date":"2024-03-24T00:00+08:00","max":1,"min":1,"avg":1}],"pressure":[{"date":"2024-03-24T00:00+08:00","max":101270.62,"min":100700.18,"avg":101214.41}],"visibility":[{"date":"2024-03-24T00:00+08:00","max":24.14,"min":1.38,"avg":1.79}],"dswrf":[{"date":"2024-03-24T00:00+08:00","max":46.3,"min":0,"avg":0}],"air_quality":{"aqi":[{"date":"2024-03-24T00:00+08:00","max":{"chn":89,"usa":156},"avg":{"chn":48,"usa":86},"min":{"chn":40,"usa":76}}],"pm25":[{"date":"2024-03-24T00:00+08:00","max":66,"avg":29,"min":24}]},"skycon":[{"date":"2024-03-24T00:00+08:00","value":"HEAVY_RAIN"}],"skycon_08h_20h":[{"date":"2024-03-24T00:00+08:00","value":"CLOUDY"}],"skycon_20h_32h":[{"date":"2024-03-24T00:00+08:00","value":"MODERATE_RAIN"}],"life_index":{"ultraviolet":[{"date":"2024-03-24T00:00+08:00","index":"1","desc":"最弱"}],"carWashing":[{"date":"2024-03-24T00:00+08:00","index":"3","desc":"较不适宜"}],"dressing":[{"date":"2024-03-24T00:00+08:00","index":"7","desc":"寒冷"}],"comfort":[{"date":"2024-03-24T00:00+08:00","index":"9","desc":"寒冷"}],"coldRisk":[{"date":"2024-03-24T00:00+08:00","index":"3","desc":"易发"}]}},"primary":0,"forecast_keypoint":"19分钟后雨渐小，转为小雨，直到一小时后雨停"}}
`

export function getComprehensiveUrl(token: string, position: LongLatitude = defaultLongLatitude) {
    return `https://api.caiyunapp.com/v2.6/TAkhjf8d1nlSlspN/${parseCaiyunLLFormat(position)}/weather?alert=true&dailysteps=1&hourlysteps=24&token=${token}`
}

export async function getComprehensiveTestSuccess(token: string, position: LongLatitude = defaultLongLatitude) {
    return new Promise<Comprehensive>((resolve) => {
        const url = getComprehensiveUrl(token, position);
        console.log(url)

        setTimeout(() => {
            resolve(JSON.parse(testJson) as Comprehensive)
        }, 1000);
    })
}

export async function getComprehensiveTestFailed(token: string, position: LongLatitude = defaultLongLatitude) {
    return new Promise<Comprehensive>((_, reject) => {
        const url = getComprehensiveUrl(token, position);
        console.log(url)

        setTimeout(() => {
            reject(JSON.parse(testJson) as Comprehensive)
        }, 1000);
    })
}

export async function getComprehensive(token: string, position: LongLatitude = defaultLongLatitude) {
    return new Promise<Comprehensive>((resolve, reject) => {
        axios.get(getComprehensiveUrl(token, position))
            .then((response) => {
                const data = response.data as Comprehensive;
                if (data.status == 'ok') {
                    resolve(response.data as Comprehensive)
                } else {
                    reject(response)
                }
            })
            .catch(e => {
                reject(e)
            });
    });
}


export interface Comprehensive {
    status: 'ok' | 'failed';
    api_version: string;
    api_status: string;
    lang: string;
    unit: string;
    tzshift: number;
    timezone: string;
    server_time: number;
    location: number[];
    result: ComprehensiveResult;
}

export interface ComprehensiveResult {
    alert: AlertResult,
    realtime: RealtimeData,
    minutely: MinutelyData,
    hourly: HourlyData,
    daily: DailyData,
    primary: number;
    forecast_keypoint: string;
}