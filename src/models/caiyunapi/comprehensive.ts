import {RealtimeData} from "./realtime.ts";
import {MinutelyData} from "./minutely.ts";
import {HourlyData} from "./hourly.ts";
import {DailyData} from "./daily.ts";
import {AlertResult} from "./alert.ts";
import {defaultLongLatitude, LongLatitude, parseCaiyunLLFormat} from "../models.ts";
import axios from "axios"

const testJson = `
{"status":"ok","api_version":"v2.6","api_status":"alpha","lang":"zh_CN","unit":"metric","tzshift":28800,"timezone":"Asia/Shanghai","server_time":1711354935,"location":[30.31,120.35],"result":{"alert":{"status":"ok","content":[{"province":"浙江省","status":"预警中","code":"0902","description":"杭州市钱塘区气象台2024年03月25日14时40分发布雷电黄色预警信号：受强对流云团影响，预计今天下午到前半夜我区所有街道将出现雷阵雨天气，请注意防范强雷电的不利影响，尽量避免户外活动。","regionId":"","county":"钱塘区","pubtimestamp":1711348800,"latlon":[30.32304,120.493941],"city":"杭州市","alertId":"33011441600000_20240325144217","title":"杭州市钱塘区气象台发布雷电黄色预警[Ⅲ级/较重]","adcode":"330114","source":"国家预警信息发布中心","location":"浙江省杭州市钱塘区","request_status":"ok"}],"adcodes":[{"adcode":330000,"name":"浙江省"},{"adcode":330100,"name":"杭州市"},{"adcode":330114,"name":"钱塘区"}]},"realtime":{"status":"ok","temperature":16.18,"humidity":0.84,"cloudrate":0.92,"skycon":"LIGHT_RAIN","visibility":7.1,"dswrf":177.9,"wind":{"speed":27.18,"direction":330.89},"pressure":101065.43,"apparent_temperature":12.3,"precipitation":{"local":{"status":"ok","datasource":"radar","intensity":0.1158},"nearest":{"status":"ok","distance":0.81,"intensity":0.25}},"air_quality":{"pm25":7,"pm10":21,"o3":62,"so2":4,"no2":14,"co":0.8,"aqi":{"chn":22,"usa":29},"description":{"chn":"优","usa":"优"}},"life_index":{"ultraviolet":{"index":2,"desc":"很弱"},"comfort":{"index":7,"desc":"冷"}}},"minutely":{"status":"ok","datasource":"radar","precipitation_2h":[0.1158,0.1192,0.1246,0.1316,0.1402,0.1501,0.1611,0.1731,0.1858,0.199,0.2121,0.2244,0.2351,0.2437,0.2493,0.2514,0.2508,0.2489,0.247,0.2465,0.2488,0.2549,0.2646,0.2763,0.2887,0.3004,0.31,0.3162,0.3191,0.3194,0.3179,0.3156,0.3133,0.3117,0.311,0.3111,0.3115,0.312,0.3124,0.3124,0.312,0.3114,0.311,0.311,0.3117,0.3134,0.3158,0.3182,0.3195,0.3191,0.316,0.3094,0.2995,0.2876,0.2751,0.2635,0.2542,0.2486,0.2471,0.2483,0.2506,0.2524,0.2523,0.2486,0.2408,0.2302,0.218,0.2056,0.1946,0.1861,0.181,0.179,0.1793,0.1813,0.1844,0.188,0.1914,0.1942,0.1957,0.1954,0.1927,0.187,0.1782,0.1672,0.1552,0.1434,0.1329,0.125,0.1205,0.1188,0.1193,0.121,0.1231,0.1249,0.1257,0.1256,0.125,0.1244,0.1242,0.1248,0.1265,0.1287,0.1306,0.1314,0.1302,0.1262,0.1188,0.1085,0.0967,0.0846,0.0734,0.0644,0.0586,0.0561,0.0559,0.0573,0.0596,0.0619,0.0635,0.0642],"precipitation":[0.1158,0.1192,0.1246,0.1316,0.1402,0.1501,0.1611,0.1731,0.1858,0.199,0.2121,0.2244,0.2351,0.2437,0.2493,0.2514,0.2508,0.2489,0.247,0.2465,0.2488,0.2549,0.2646,0.2763,0.2887,0.3004,0.31,0.3162,0.3191,0.3194,0.3179,0.3156,0.3133,0.3117,0.311,0.3111,0.3115,0.312,0.3124,0.3124,0.312,0.3114,0.311,0.311,0.3117,0.3134,0.3158,0.3182,0.3195,0.3191,0.316,0.3094,0.2995,0.2876,0.2751,0.2635,0.2542,0.2486,0.2471,0.2483],"probability":[0.9621600454099093,0.9873531411269613,0.9716627055250928,0.9686132360104105],"description":"雨渐大，23分钟后转为中雨，不过一小时后雨会再次变小"},"hourly":{"status":"ok","description":"小雨，今天晚间22点钟后雨停，转阴","precipitation":[{"datetime":"2024-03-25T16:00+08:00","value":1.078,"probability":97},{"datetime":"2024-03-25T17:00+08:00","value":0.8558,"probability":97},{"datetime":"2024-03-25T18:00+08:00","value":0.2789,"probability":60},{"datetime":"2024-03-25T19:00+08:00","value":0.3123,"probability":60},{"datetime":"2024-03-25T20:00+08:00","value":0.0835,"probability":60},{"datetime":"2024-03-25T21:00+08:00","value":0.2883,"probability":60},{"datetime":"2024-03-25T22:00+08:00","value":0,"probability":0},{"datetime":"2024-03-25T23:00+08:00","value":0,"probability":0},{"datetime":"2024-03-26T00:00+08:00","value":0,"probability":0},{"datetime":"2024-03-26T01:00+08:00","value":0,"probability":0},{"datetime":"2024-03-26T02:00+08:00","value":0,"probability":0},{"datetime":"2024-03-26T03:00+08:00","value":0,"probability":0},{"datetime":"2024-03-26T04:00+08:00","value":0,"probability":0},{"datetime":"2024-03-26T05:00+08:00","value":0,"probability":0},{"datetime":"2024-03-26T06:00+08:00","value":0,"probability":0},{"datetime":"2024-03-26T07:00+08:00","value":0,"probability":0},{"datetime":"2024-03-26T08:00+08:00","value":0,"probability":0},{"datetime":"2024-03-26T09:00+08:00","value":0,"probability":0},{"datetime":"2024-03-26T10:00+08:00","value":0,"probability":0},{"datetime":"2024-03-26T11:00+08:00","value":0,"probability":0},{"datetime":"2024-03-26T12:00+08:00","value":0,"probability":0},{"datetime":"2024-03-26T13:00+08:00","value":0,"probability":0},{"datetime":"2024-03-26T14:00+08:00","value":0,"probability":0},{"datetime":"2024-03-26T15:00+08:00","value":0,"probability":0}],"temperature":[{"datetime":"2024-03-25T16:00+08:00","value":16.18},{"datetime":"2024-03-25T17:00+08:00","value":14.9},{"datetime":"2024-03-25T18:00+08:00","value":14.24},{"datetime":"2024-03-25T19:00+08:00","value":13.59},{"datetime":"2024-03-25T20:00+08:00","value":12.92},{"datetime":"2024-03-25T21:00+08:00","value":13.02},{"datetime":"2024-03-25T22:00+08:00","value":13.14},{"datetime":"2024-03-25T23:00+08:00","value":12.64},{"datetime":"2024-03-26T00:00+08:00","value":12.33},{"datetime":"2024-03-26T01:00+08:00","value":12.02},{"datetime":"2024-03-26T02:00+08:00","value":11.7},{"datetime":"2024-03-26T03:00+08:00","value":11.64},{"datetime":"2024-03-26T04:00+08:00","value":11.57},{"datetime":"2024-03-26T05:00+08:00","value":11.52},{"datetime":"2024-03-26T06:00+08:00","value":11.73},{"datetime":"2024-03-26T07:00+08:00","value":11.94},{"datetime":"2024-03-26T08:00+08:00","value":12.15},{"datetime":"2024-03-26T09:00+08:00","value":13.03},{"datetime":"2024-03-26T10:00+08:00","value":13.9},{"datetime":"2024-03-26T11:00+08:00","value":14.78},{"datetime":"2024-03-26T12:00+08:00","value":15.29},{"datetime":"2024-03-26T13:00+08:00","value":15.82},{"datetime":"2024-03-26T14:00+08:00","value":16.32},{"datetime":"2024-03-26T15:00+08:00","value":16.23}],"apparent_temperature":[{"datetime":"2024-03-25T16:00+08:00","value":12.3},{"datetime":"2024-03-25T17:00+08:00","value":11.3},{"datetime":"2024-03-25T18:00+08:00","value":9.7},{"datetime":"2024-03-25T19:00+08:00","value":8.3},{"datetime":"2024-03-25T20:00+08:00","value":8.4},{"datetime":"2024-03-25T21:00+08:00","value":9.3},{"datetime":"2024-03-25T22:00+08:00","value":9.5},{"datetime":"2024-03-25T23:00+08:00","value":8.5},{"datetime":"2024-03-26T00:00+08:00","value":8},{"datetime":"2024-03-26T01:00+08:00","value":7.2},{"datetime":"2024-03-26T02:00+08:00","value":7},{"datetime":"2024-03-26T03:00+08:00","value":7.4},{"datetime":"2024-03-26T04:00+08:00","value":7.8},{"datetime":"2024-03-26T05:00+08:00","value":7.9},{"datetime":"2024-03-26T06:00+08:00","value":8.6},{"datetime":"2024-03-26T07:00+08:00","value":9.1},{"datetime":"2024-03-26T08:00+08:00","value":8.9},{"datetime":"2024-03-26T09:00+08:00","value":10},{"datetime":"2024-03-26T10:00+08:00","value":11.3},{"datetime":"2024-03-26T11:00+08:00","value":12.5},{"datetime":"2024-03-26T12:00+08:00","value":13.3},{"datetime":"2024-03-26T13:00+08:00","value":14.1},{"datetime":"2024-03-26T14:00+08:00","value":14.7},{"datetime":"2024-03-26T15:00+08:00","value":14.2}],"wind":[{"datetime":"2024-03-25T16:00+08:00","speed":27.18,"direction":330.89},{"datetime":"2024-03-25T17:00+08:00","speed":23.82,"direction":328.26},{"datetime":"2024-03-25T18:00+08:00","speed":28.23,"direction":325.27},{"datetime":"2024-03-25T19:00+08:00","speed":31.64,"direction":321.69},{"datetime":"2024-03-25T20:00+08:00","speed":26.55,"direction":318.25},{"datetime":"2024-03-25T21:00+08:00","speed":22.13,"direction":314.43},{"datetime":"2024-03-25T22:00+08:00","speed":21.52,"direction":317.25},{"datetime":"2024-03-25T23:00+08:00","speed":23.83,"direction":319.58},{"datetime":"2024-03-26T00:00+08:00","speed":24.62,"direction":315.67},{"datetime":"2024-03-26T01:00+08:00","speed":26.92,"direction":313.48},{"datetime":"2024-03-26T02:00+08:00","speed":25.42,"direction":314.41},{"datetime":"2024-03-26T03:00+08:00","speed":23.11,"direction":307.39},{"datetime":"2024-03-26T04:00+08:00","speed":20.61,"direction":303.23},{"datetime":"2024-03-26T05:00+08:00","speed":19.65,"direction":314.21},{"datetime":"2024-03-26T06:00+08:00","speed":17.36,"direction":313.25},{"datetime":"2024-03-26T07:00+08:00","speed":15.36,"direction":316.85},{"datetime":"2024-03-26T08:00+08:00","speed":17.65,"direction":328.97},{"datetime":"2024-03-26T09:00+08:00","speed":16.58,"direction":340.11},{"datetime":"2024-03-26T10:00+08:00","speed":14.39,"direction":350.92},{"datetime":"2024-03-26T11:00+08:00","speed":12.6,"direction":352.86},{"datetime":"2024-03-26T12:00+08:00","speed":10.9,"direction":358.03},{"datetime":"2024-03-26T13:00+08:00","speed":9.81,"direction":8.8},{"datetime":"2024-03-26T14:00+08:00","speed":9.72,"direction":28.49},{"datetime":"2024-03-26T15:00+08:00","speed":11.38,"direction":32.23}],"humidity":[{"datetime":"2024-03-25T16:00+08:00","value":0.84},{"datetime":"2024-03-25T17:00+08:00","value":0.83},{"datetime":"2024-03-25T18:00+08:00","value":0.84},{"datetime":"2024-03-25T19:00+08:00","value":0.83},{"datetime":"2024-03-25T20:00+08:00","value":0.82},{"datetime":"2024-03-25T21:00+08:00","value":0.82},{"datetime":"2024-03-25T22:00+08:00","value":0.81},{"datetime":"2024-03-25T23:00+08:00","value":0.81},{"datetime":"2024-03-26T00:00+08:00","value":0.81},{"datetime":"2024-03-26T01:00+08:00","value":0.8},{"datetime":"2024-03-26T02:00+08:00","value":0.79},{"datetime":"2024-03-26T03:00+08:00","value":0.8},{"datetime":"2024-03-26T04:00+08:00","value":0.79},{"datetime":"2024-03-26T05:00+08:00","value":0.79},{"datetime":"2024-03-26T06:00+08:00","value":0.8},{"datetime":"2024-03-26T07:00+08:00","value":0.79},{"datetime":"2024-03-26T08:00+08:00","value":0.75},{"datetime":"2024-03-26T09:00+08:00","value":0.7},{"datetime":"2024-03-26T10:00+08:00","value":0.67},{"datetime":"2024-03-26T11:00+08:00","value":0.63},{"datetime":"2024-03-26T12:00+08:00","value":0.61},{"datetime":"2024-03-26T13:00+08:00","value":0.59},{"datetime":"2024-03-26T14:00+08:00","value":0.58},{"datetime":"2024-03-26T15:00+08:00","value":0.57}],"cloudrate":[{"datetime":"2024-03-25T16:00+08:00","value":0.92},{"datetime":"2024-03-25T17:00+08:00","value":1},{"datetime":"2024-03-25T18:00+08:00","value":1},{"datetime":"2024-03-25T19:00+08:00","value":1},{"datetime":"2024-03-25T20:00+08:00","value":1},{"datetime":"2024-03-25T21:00+08:00","value":1},{"datetime":"2024-03-25T22:00+08:00","value":1},{"datetime":"2024-03-25T23:00+08:00","value":1},{"datetime":"2024-03-26T00:00+08:00","value":0.78},{"datetime":"2024-03-26T01:00+08:00","value":0.56},{"datetime":"2024-03-26T02:00+08:00","value":0.34},{"datetime":"2024-03-26T03:00+08:00","value":0.56},{"datetime":"2024-03-26T04:00+08:00","value":0.79},{"datetime":"2024-03-26T05:00+08:00","value":1},{"datetime":"2024-03-26T06:00+08:00","value":0.99},{"datetime":"2024-03-26T07:00+08:00","value":0.98},{"datetime":"2024-03-26T08:00+08:00","value":0.97},{"datetime":"2024-03-26T09:00+08:00","value":0.98},{"datetime":"2024-03-26T10:00+08:00","value":0.99},{"datetime":"2024-03-26T11:00+08:00","value":1},{"datetime":"2024-03-26T12:00+08:00","value":0.95},{"datetime":"2024-03-26T13:00+08:00","value":0.9},{"datetime":"2024-03-26T14:00+08:00","value":0.86},{"datetime":"2024-03-26T15:00+08:00","value":0.74}],"skycon":[{"datetime":"2024-03-25T16:00+08:00","value":"MODERATE_RAIN"},{"datetime":"2024-03-25T17:00+08:00","value":"LIGHT_RAIN"},{"datetime":"2024-03-25T18:00+08:00","value":"LIGHT_RAIN"},{"datetime":"2024-03-25T19:00+08:00","value":"LIGHT_RAIN"},{"datetime":"2024-03-25T20:00+08:00","value":"LIGHT_RAIN"},{"datetime":"2024-03-25T21:00+08:00","value":"LIGHT_RAIN"},{"datetime":"2024-03-25T22:00+08:00","value":"CLOUDY"},{"datetime":"2024-03-25T23:00+08:00","value":"CLOUDY"},{"datetime":"2024-03-26T00:00+08:00","value":"PARTLY_CLOUDY_NIGHT"},{"datetime":"2024-03-26T01:00+08:00","value":"PARTLY_CLOUDY_NIGHT"},{"datetime":"2024-03-26T02:00+08:00","value":"PARTLY_CLOUDY_NIGHT"},{"datetime":"2024-03-26T03:00+08:00","value":"PARTLY_CLOUDY_NIGHT"},{"datetime":"2024-03-26T04:00+08:00","value":"PARTLY_CLOUDY_NIGHT"},{"datetime":"2024-03-26T05:00+08:00","value":"CLOUDY"},{"datetime":"2024-03-26T06:00+08:00","value":"CLOUDY"},{"datetime":"2024-03-26T07:00+08:00","value":"CLOUDY"},{"datetime":"2024-03-26T08:00+08:00","value":"CLOUDY"},{"datetime":"2024-03-26T09:00+08:00","value":"CLOUDY"},{"datetime":"2024-03-26T10:00+08:00","value":"CLOUDY"},{"datetime":"2024-03-26T11:00+08:00","value":"CLOUDY"},{"datetime":"2024-03-26T12:00+08:00","value":"CLOUDY"},{"datetime":"2024-03-26T13:00+08:00","value":"CLOUDY"},{"datetime":"2024-03-26T14:00+08:00","value":"CLOUDY"},{"datetime":"2024-03-26T15:00+08:00","value":"PARTLY_CLOUDY_DAY"}],"pressure":[{"datetime":"2024-03-25T16:00+08:00","value":101065.432},{"datetime":"2024-03-25T17:00+08:00","value":101188.951},{"datetime":"2024-03-25T18:00+08:00","value":101376.013},{"datetime":"2024-03-25T19:00+08:00","value":101499.025},{"datetime":"2024-03-25T20:00+08:00","value":101624.274},{"datetime":"2024-03-25T21:00+08:00","value":101748.285},{"datetime":"2024-03-25T22:00+08:00","value":101762.23},{"datetime":"2024-03-25T23:00+08:00","value":101846.612},{"datetime":"2024-03-26T00:00+08:00","value":101904.755},{"datetime":"2024-03-26T01:00+08:00","value":101984.259},{"datetime":"2024-03-26T02:00+08:00","value":102003.235},{"datetime":"2024-03-26T03:00+08:00","value":102072.771},{"datetime":"2024-03-26T04:00+08:00","value":102148.376},{"datetime":"2024-03-26T05:00+08:00","value":102175.185},{"datetime":"2024-03-26T06:00+08:00","value":102260.203},{"datetime":"2024-03-26T07:00+08:00","value":102358.715},{"datetime":"2024-03-26T08:00+08:00","value":102402.705},{"datetime":"2024-03-26T09:00+08:00","value":102410.263},{"datetime":"2024-03-26T10:00+08:00","value":102424.717},{"datetime":"2024-03-26T11:00+08:00","value":102439.283},{"datetime":"2024-03-26T12:00+08:00","value":102398.919},{"datetime":"2024-03-26T13:00+08:00","value":102329.044},{"datetime":"2024-03-26T14:00+08:00","value":102236.315},{"datetime":"2024-03-26T15:00+08:00","value":102179.318}],"visibility":[{"datetime":"2024-03-25T16:00+08:00","value":7.1},{"datetime":"2024-03-25T17:00+08:00","value":7.15},{"datetime":"2024-03-25T18:00+08:00","value":7.03},{"datetime":"2024-03-25T19:00+08:00","value":7.33},{"datetime":"2024-03-25T20:00+08:00","value":7.54},{"datetime":"2024-03-25T21:00+08:00","value":7.66},{"datetime":"2024-03-25T22:00+08:00","value":7.94},{"datetime":"2024-03-25T23:00+08:00","value":7.9},{"datetime":"2024-03-26T00:00+08:00","value":8.08},{"datetime":"2024-03-26T01:00+08:00","value":8.32},{"datetime":"2024-03-26T02:00+08:00","value":8.7},{"datetime":"2024-03-26T03:00+08:00","value":8.47},{"datetime":"2024-03-26T04:00+08:00","value":8.87},{"datetime":"2024-03-26T05:00+08:00","value":8.88},{"datetime":"2024-03-26T06:00+08:00","value":8.43},{"datetime":"2024-03-26T07:00+08:00","value":8.86},{"datetime":"2024-03-26T08:00+08:00","value":11.18},{"datetime":"2024-03-26T09:00+08:00","value":16.25},{"datetime":"2024-03-26T10:00+08:00","value":16.74},{"datetime":"2024-03-26T11:00+08:00","value":16.74},{"datetime":"2024-03-26T12:00+08:00","value":16.74},{"datetime":"2024-03-26T13:00+08:00","value":16.74},{"datetime":"2024-03-26T14:00+08:00","value":16.74},{"datetime":"2024-03-26T15:00+08:00","value":16.74}],"dswrf":[{"datetime":"2024-03-25T16:00+08:00","value":177.858},{"datetime":"2024-03-25T17:00+08:00","value":135.792},{"datetime":"2024-03-25T18:00+08:00","value":108.554},{"datetime":"2024-03-25T19:00+08:00","value":90.394},{"datetime":"2024-03-25T20:00+08:00","value":0},{"datetime":"2024-03-25T21:00+08:00","value":0},{"datetime":"2024-03-25T22:00+08:00","value":0},{"datetime":"2024-03-25T23:00+08:00","value":0},{"datetime":"2024-03-26T00:00+08:00","value":0},{"datetime":"2024-03-26T01:00+08:00","value":0},{"datetime":"2024-03-26T02:00+08:00","value":0},{"datetime":"2024-03-26T03:00+08:00","value":0},{"datetime":"2024-03-26T04:00+08:00","value":0},{"datetime":"2024-03-26T05:00+08:00","value":0},{"datetime":"2024-03-26T06:00+08:00","value":13.007},{"datetime":"2024-03-26T07:00+08:00","value":45.504},{"datetime":"2024-03-26T08:00+08:00","value":491.454},{"datetime":"2024-03-26T09:00+08:00","value":574.959},{"datetime":"2024-03-26T10:00+08:00","value":594.066},{"datetime":"2024-03-26T11:00+08:00","value":568.872},{"datetime":"2024-03-26T12:00+08:00","value":568.924},{"datetime":"2024-03-26T13:00+08:00","value":575.576},{"datetime":"2024-03-26T14:00+08:00","value":680.373},{"datetime":"2024-03-26T15:00+08:00","value":612.739}],"air_quality":{"aqi":[{"datetime":"2024-03-25T16:00+08:00","value":{"chn":22,"usa":29}},{"datetime":"2024-03-25T17:00+08:00","value":{"chn":36,"usa":57}},{"datetime":"2024-03-25T18:00+08:00","value":{"chn":35,"usa":57}},{"datetime":"2024-03-25T19:00+08:00","value":{"chn":34,"usa":59}},{"datetime":"2024-03-25T20:00+08:00","value":{"chn":35,"usa":61}},{"datetime":"2024-03-25T21:00+08:00","value":{"chn":32,"usa":63}},{"datetime":"2024-03-25T22:00+08:00","value":{"chn":30,"usa":65}},{"datetime":"2024-03-25T23:00+08:00","value":{"chn":30,"usa":69}},{"datetime":"2024-03-26T00:00+08:00","value":{"chn":30,"usa":69}},{"datetime":"2024-03-26T01:00+08:00","value":{"chn":30,"usa":69}},{"datetime":"2024-03-26T02:00+08:00","value":{"chn":31,"usa":71}},{"datetime":"2024-03-26T03:00+08:00","value":{"chn":31,"usa":71}},{"datetime":"2024-03-26T04:00+08:00","value":{"chn":31,"usa":71}},{"datetime":"2024-03-26T05:00+08:00","value":{"chn":31,"usa":71}},{"datetime":"2024-03-26T06:00+08:00","value":{"chn":30,"usa":69}},{"datetime":"2024-03-26T07:00+08:00","value":{"chn":28,"usa":67}},{"datetime":"2024-03-26T08:00+08:00","value":{"chn":28,"usa":67}},{"datetime":"2024-03-26T09:00+08:00","value":{"chn":28,"usa":67}},{"datetime":"2024-03-26T10:00+08:00","value":{"chn":28,"usa":67}},{"datetime":"2024-03-26T11:00+08:00","value":{"chn":30,"usa":69}},{"datetime":"2024-03-26T12:00+08:00","value":{"chn":34,"usa":67}},{"datetime":"2024-03-26T13:00+08:00","value":{"chn":37,"usa":67}},{"datetime":"2024-03-26T14:00+08:00","value":{"chn":28,"usa":67}},{"datetime":"2024-03-26T15:00+08:00","value":{"chn":33,"usa":63}}],"pm25":[{"datetime":"2024-03-25T16:00+08:00","value":7},{"datetime":"2024-03-25T17:00+08:00","value":15},{"datetime":"2024-03-25T18:00+08:00","value":15},{"datetime":"2024-03-25T19:00+08:00","value":16},{"datetime":"2024-03-25T20:00+08:00","value":17},{"datetime":"2024-03-25T21:00+08:00","value":18},{"datetime":"2024-03-25T22:00+08:00","value":19},{"datetime":"2024-03-25T23:00+08:00","value":21},{"datetime":"2024-03-26T00:00+08:00","value":21},{"datetime":"2024-03-26T01:00+08:00","value":21},{"datetime":"2024-03-26T02:00+08:00","value":22},{"datetime":"2024-03-26T03:00+08:00","value":22},{"datetime":"2024-03-26T04:00+08:00","value":22},{"datetime":"2024-03-26T05:00+08:00","value":22},{"datetime":"2024-03-26T06:00+08:00","value":21},{"datetime":"2024-03-26T07:00+08:00","value":20},{"datetime":"2024-03-26T08:00+08:00","value":20},{"datetime":"2024-03-26T09:00+08:00","value":20},{"datetime":"2024-03-26T10:00+08:00","value":20},{"datetime":"2024-03-26T11:00+08:00","value":21},{"datetime":"2024-03-26T12:00+08:00","value":20},{"datetime":"2024-03-26T13:00+08:00","value":20},{"datetime":"2024-03-26T14:00+08:00","value":20},{"datetime":"2024-03-26T15:00+08:00","value":18}]}},"daily":{"status":"ok","astro":[{"date":"2024-03-25T00:00+08:00","sunrise":{"time":"05:55"},"sunset":{"time":"18:13"}}],"precipitation_08h_20h":[{"date":"2024-03-25T00:00+08:00","max":1.078,"min":0,"avg":0.3021,"probability":60}],"precipitation_20h_32h":[{"date":"2024-03-25T00:00+08:00","max":0.3123,"min":0,"avg":0.057,"probability":60}],"precipitation":[{"date":"2024-03-25T00:00+08:00","max":1.078,"min":0,"avg":0.3621,"probability":60}],"temperature":[{"date":"2024-03-25T00:00+08:00","max":21.88,"min":12.64,"avg":13.83}],"temperature_08h_20h":[{"date":"2024-03-25T00:00+08:00","max":21.88,"min":13.06,"avg":17.08}],"temperature_20h_32h":[{"date":"2024-03-25T00:00+08:00","max":13.59,"min":11.52,"avg":12.32}],"wind":[{"date":"2024-03-25T00:00+08:00","max":{"speed":31.64,"direction":321.69},"min":{"speed":3.69,"direction":88.6},"avg":{"speed":16.92,"direction":333.14}}],"wind_08h_20h":[{"date":"2024-03-25T00:00+08:00","max":{"speed":28.23,"direction":325.27},"min":{"speed":3.69,"direction":88.6},"avg":{"speed":18.02,"direction":329.28}}],"wind_20h_32h":[{"date":"2024-03-25T00:00+08:00","max":{"speed":31.64,"direction":321.69},"min":{"speed":17.36,"direction":313.25},"avg":{"speed":23.61,"direction":314.79}}],"humidity":[{"date":"2024-03-25T00:00+08:00","max":0.96,"min":0.79,"avg":0.82}],"cloudrate":[{"date":"2024-03-25T00:00+08:00","max":1,"min":0.45,"avg":0.99}],"pressure":[{"date":"2024-03-25T00:00+08:00","max":101846.61,"min":100826.88,"avg":101513.85}],"visibility":[{"date":"2024-03-25T00:00+08:00","max":20.61,"min":0.11,"avg":7.46}],"dswrf":[{"date":"2024-03-25T00:00+08:00","max":506.4,"min":0,"avg":64.1}],"air_quality":{"aqi":[{"date":"2024-03-25T00:00+08:00","max":{"chn":94,"usa":158},"avg":{"chn":32,"usa":58},"min":{"chn":21,"usa":29}}],"pm25":[{"date":"2024-03-25T00:00+08:00","max":70,"avg":16,"min":7}]},"skycon":[{"date":"2024-03-25T00:00+08:00","value":"LIGHT_RAIN"}],"skycon_08h_20h":[{"date":"2024-03-25T00:00+08:00","value":"LIGHT_RAIN"}],"skycon_20h_32h":[{"date":"2024-03-25T00:00+08:00","value":"LIGHT_RAIN"}],"life_index":{"ultraviolet":[{"date":"2024-03-25T00:00+08:00","index":"1","desc":"最弱"}],"carWashing":[{"date":"2024-03-25T00:00+08:00","index":"3","desc":"较不适宜"}],"dressing":[{"date":"2024-03-25T00:00+08:00","index":"6","desc":"冷"}],"comfort":[{"date":"2024-03-25T00:00+08:00","index":"7","desc":"冷"}],"coldRisk":[{"date":"2024-03-25T00:00+08:00","index":"4","desc":"极易发"}]}},"primary":0,"forecast_keypoint":"雨渐大，23分钟后转为中雨，不过一小时后雨会再次变小"}}
`
export function getComprehensiveUrl(token: string, position: LongLatitude = defaultLongLatitude) {
    return `https://api.caiyunapp.com/v2.6/TAkhjf8d1nlSlspN/${parseCaiyunLLFormat(position)}/weather?alert=true&dailysteps=1&hourlysteps=24&token=${token}`
}

export async function getComprehensiveTestSuccess(token: string, position: LongLatitude = defaultLongLatitude) {
    return new Promise<Comprehensive>((resolve) => {
        const url = getComprehensiveUrl(token, position);
        console.log(url)

        setTimeout(() => {
            resolve(JSON.parse(testJson) as Comprehensive)
        }, 1000);
    })
}

export async function getComprehensiveTestFailed(token: string, position: LongLatitude = defaultLongLatitude) {
    return new Promise<Comprehensive>((_, reject) => {
        const url = getComprehensiveUrl(token, position);
        console.log(url)

        setTimeout(() => {
            reject(JSON.parse(testJson) as Comprehensive)
        }, 1000);
    })
}

export async function getComprehensive(token: string, position: LongLatitude = defaultLongLatitude) {
    return new Promise<Comprehensive>((resolve, reject) => {
        axios.get(getComprehensiveUrl(token, position))
            .then((response) => {
                const data = response.data as Comprehensive;
                if (data.status == 'ok') {
                    resolve(response.data as Comprehensive)
                } else {
                    reject(response)
                }
            })
            .catch(e => {
                reject(e)
            });
    });
}


export interface Comprehensive {
    status: 'ok' | 'failed';
    api_version: string;
    api_status: string;
    lang: string;
    unit: string;
    tzshift: number;
    timezone: string;
    server_time: number;
    location: number[];
    result: ComprehensiveResult;
}

export interface ComprehensiveResult {
    alert: AlertResult,
    realtime: RealtimeData,
    minutely: MinutelyData,
    hourly: HourlyData,
    daily: DailyData,
    primary: number;
    forecast_keypoint: string;
}